<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <img src="assets/estonantzin.jpeg" alt="Logo Estudiantina" class="logo">
        <h4>Estudiantina Tonantzin Guadalupe</h4>
      </div>
      <div class="user-info">
        <div class="user-avatar" (click)="openProfileModal()" *ngIf="userProfile?.profileImage">
          <img [src]="userProfile.profileImage" alt="Mi Foto de Perfil" class="avatar-image">
        </div>
        <div class="user-avatar default-avatar" (click)="openProfileModal()" *ngIf="!userProfile?.profileImage">
          <i class="fas fa-user-circle" style="font-size: 125px; color: rgba(255,255,255,0.8);"></i>
        </div>
        <div class="user-text">
          <span class="user-name">{{ userProfile?.nickname || userProfile?.name || 'Usuario' }}</span>
          <span class="user-email">{{ user?.email }}</span>
        </div>
        <div class="user-buttons">
          <button class="profile-btn" (click)="openProfileModal()">
            <i class="fas fa-edit"></i> Mi Perfil
          </button>
          <button class="logout-btn" (click)="logout()">
            <i class="fas fa-sign-out-alt"></i> Cerrar SesiÃ³n
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="dashboard-main">

    <!-- Mi Tarjeta Bancaria -->
    <div *ngIf="userAccount">
      <div class="user-card">
        <div class="card-design clickable-card" (click)="viewCardMovements()">
          <div class="card-header">
            <div class="card-brand">
              <span class="card-type">ESTUDIANTINA</span>
              <span class="card-subtitle">TONANTZIN GUADALUPE</span>
            </div>
            <div class="card-label">
              <span class="card-text">CARD</span>
            </div>
          </div>
          
          <div class="card-number">
            {{ userAccount.cardNumber | slice:0:4 }} {{ userAccount.cardNumber | slice:4:8 }} {{ userAccount.cardNumber | slice:8:12 }} {{ userAccount.cardNumber | slice:-4 }}
          </div>
          
          <div class="card-info">
            <div class="account-holder">
              <span class="label">TITULAR</span>
              <span class="value">{{ userAccount.userName }}</span>
            </div>
            <div class="account-number">
              <span class="label">CUENTA</span>
              <span class="value">{{ userAccount.accountNumber }}</span>
            </div>
          </div>
          
          <div class="card-balance">
            <span class="balance-label">SALDO DISPONIBLE</span>
            <span class="balance-amount">${{ userAccount.balance.toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </div>
    <br><br>
    <!-- Acciones -->
    <div class="actions">
      <button class="action" routerLink="/attendance-tracking">
        <span class="action-icon">ğŸ“Š</span>
        <span class="action-text">Mi asistencia</span>
      </button>
      
      <button class="action" routerLink="/admin" *ngIf="isAdmin">
        <span class="action-icon">âš™ï¸</span>
        <span class="action-text">Usuarios</span>
      </button>
      
      <button class="action" routerLink="/attendance" *ngIf="canManageAttendance">
        <span class="action-icon">âœ“</span>
        <span class="action-text">Asistencia</span>
      </button>
      
      <button class="action" routerLink="/attendance-summary" *ngIf="canManageAttendance">
        <span class="action-icon">ğŸ“‹</span>
        <span class="action-text">Resumen</span>
      </button>
      
      <button class="action" routerLink="/event-management" *ngIf="canManageEvents">
        <span class="action-icon">ğŸ‰</span>
        <span class="action-text">Eventos</span>
      </button>
      
      <button class="action" routerLink="/transport-management" *ngIf="canManageTransport">
        <span class="action-icon">ğŸšŒ</span>
        <span class="action-text">Transporte</span>
      </button>
      
      <button class="action" routerLink="/ticket-sales" *ngIf="canManageTickets">
        <span class="action-icon">ğŸ«</span>
        <span class="action-text">Boletos</span>
      </button>
      
      <button class="action" routerLink="/financial-management" *ngIf="canManageTickets">
        <span class="action-icon">ğŸ¦</span>
        <span class="action-text">Finanzas</span>
      </button>
      
      <button class="action" routerLink="/payment-requests" *ngIf="canManagePayments">
        <span class="action-icon">ğŸ’°</span>
        <span class="action-text">Solicitudes de Pago</span>
      </button>
      
      <button class="action" routerLink="/songbook" *ngIf="isAdmin">
        <span class="action-icon">ğŸµ</span>
        <span class="action-text">Nueva canciÃ³n</span>
      </button>
      <button class="action" routerLink="/songbook-list">
        <span class="action-icon">ğŸ“–</span>
        <span class="action-text">Ver canciones</span>
      </button>
      
      <button class="action" routerLink="/documento-control" *ngIf="isAdmin || isDocumentador">
        <span class="action-icon">ğŸ“‹</span>
        <span class="action-text">Control Documentos</span>
      </button>

      <button class="action" routerLink="/mis-documentos">
        <span class="action-icon">ğŸ“„</span>
        <span class="action-text">Mis Documentos</span>
      </button>
      
      <!-- GestiÃ³n de AlmacÃ©n -->
      <button class="action" routerLink="/inventory-management" *ngIf="canManageInventory">
        <span class="action-icon">ğŸ“¦</span>
        <span class="action-text">GestiÃ³n de AlmacÃ©n</span>
      </button>
      
      <button class="action" routerLink="/supply-request" *ngIf="canRequestSupplies">
        <span class="action-icon">ğŸ›’</span>
        <span class="action-text">Solicitar Insumos</span>
      </button>
      <!---->
    </div>

    <!-- Documentos Pendientes de Firmar -->
    <div class="document-notifications" *ngIf="pendingDocumentsCount > 0">
      <div class="notification-card urgent">
        <div class="notification-header">
          <div class="notification-icon">ğŸ“„</div>
          <div class="notification-title">
            <h3>Documentos Pendientes de Firma</h3>
            <p>Tienes {{ pendingDocumentsCount }} documento{{ pendingDocumentsCount > 1 ? 's' : '' }} esperando tu firma fÃ­sica</p>
          </div>
        </div>
        
        <div class="notification-actions">
          <button class="btn-primary" (click)="goToMyDocuments()">
            <span class="btn-icon">âœï¸</span>
            Ver Documentos Pendientes
          </button>
        </div>
        
        <div class="documents-preview" *ngIf="pendingDocuments.length > 0">
          <div class="document-preview" *ngFor="let doc of pendingDocuments.slice(0, 2)">
            <div class="document-info">
              <span class="document-title">{{ doc.titulo }}</span>
              <span class="document-version">v{{ doc.version }}</span>
            </div>
          </div>
          <div class="more-documents" *ngIf="pendingDocuments.length > 2">
            <span>+{{ pendingDocuments.length - 2 }} documento{{ pendingDocuments.length - 2 > 1 ? 's' : '' }} mÃ¡s</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Solicitudes de Pago Pendientes -->
    <div class="payment-notifications" *ngIf="pendingPayments.length > 0">
      <h3>ğŸ’° Solicitudes de Pago Pendientes</h3>
      <div class="payments-list">
        <div class="payment-notification" *ngFor="let payment of pendingPayments">
          <div class="payment-header">
            <h4>{{ payment.concept }}</h4>
            <span class="amount">${{ payment.amount }}</span>
          </div>
          <div class="payment-details">
            <div class="detail-row">
              <span class="detail-icon">ğŸ“…</span>
              <span>Vence: {{ payment.dueDate?.toDate() | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-row" *ngIf="payment.description">
              <span class="detail-icon">ğŸ“</span>
              <span>{{ payment.description }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Mis Pagos Realizados -->
    <div class="my-payments-section" *ngIf="getUniqueConcepts().length > 0">
      <h3>ğŸ’³ Pagos de Cuotas Pendientes</h3>
      <div class="payments-summary">
        <!-- Resumen por concepto -->
        <div class="payments-by-concept" *ngFor="let concept of getUniqueConcepts()">
          <div class="concept-header">
            <h4>{{ concept }}</h4>
            <div class="quota-progress">
              <span class="progress-info">
                ${{ getTotalPaidByConcept(concept).toFixed(2) }} / ${{ getTotalQuotaForConcept(concept).toFixed(2) }}
              </span>
              <span class="remaining-amount" *ngIf="getRemainingAmountForConcept(concept) > 0">
                Faltan ${{ getRemainingAmountForConcept(concept).toFixed(2) }}
              </span>
            </div>
          </div>
          <div class="quota-progress-bar">
            <div class="progress-bar-fill" [style.width.%]="getPaymentProgressPercentage(concept)"></div>
          </div>
          <div class="concept-payments">
            <div class="payment-record" *ngFor="let payment of getPaymentsByConcept(concept).slice(0, 3)">
              <div class="payment-info">
                <span class="payment-amount">${{ payment.amount }}</span>
                <span class="payment-date">{{ payment.createdAt?.toDate() | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <div class="payment-description" *ngIf="payment.description">
                {{ payment.description }}
              </div>
            </div>
            <div class="more-payments" *ngIf="getPaymentsByConcept(concept).length > 3">
              <span>+{{ getPaymentsByConcept(concept).length - 3 }} pagos mÃ¡s</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Agenda de Eventos -->
    <div class="events-agenda">
      <h3>PrÃ³ximos Eventos</h3>
      <div class="events-list" *ngIf="activeEvents.length > 0">
        <div class="event-item" *ngFor="let event of activeEvents">
          <div class="event-main-info">
            <div class="event-header">
              <h4 class="event-title">{{ event.title }}</h4>
              <div class="event-badges">
                <span class="type-badge" [class]="event.type">{{ getTypeText(event.type) }}</span>
                <span class="attire-badge" [class]="event.attire">{{ getAttireText(event.attire) }}</span>
              </div>
            </div>
            
            <div class="event-details">
              <div class="event-date">
                <span class="date-icon">ğŸ“…</span>
                <span>{{ event.date }}</span>
              </div>
              <div class="event-location" *ngIf="event.location">
                <span class="location-icon">ğŸ“</span>
                <span>{{ event.location }}</span>
              </div>
              <div class="event-times" *ngIf="event.meetingTime || event.startTime">
                <span class="time-icon">ğŸ•°ï¸</span>
                <span *ngIf="event.meetingTime">ReuniÃ³n: {{ event.meetingTime }}</span>
                <span *ngIf="event.startTime"> | Inicio: {{ event.startTime }}</span>
              </div>
            </div>
          </div>
          
          <div class="event-confirmation">
            <div class="confirmation-status">
              <span class="confirmation-label">Tu confirmaciÃ³n:</span>
              <span class="confirmation-badge" [class]="getConfirmationClass(event.userConfirmation)">
                {{ getConfirmationText(event.userConfirmation) }}
              </span>
            </div>
            <div class="companions-info" *ngIf="event.requiresTransport && event.userConfirmation?.companions !== undefined && event.userConfirmation?.companions !== null">
              <span class="companions-text">ğŸšŒ {{ event.userConfirmation?.companions || 0 }} acompaÃ±antes</span>
            </div>
            <div class="total-people-info" *ngIf="event.requiresTransport">
              <span class="total-people-text">ğŸ‘¥ {{ getTotalPeopleForEvent(event) }} personas total</span>
            </div>
            
            <div class="transport-info" *ngIf="event.requiresTransport && hasTransportConfig(event.id)">
              <button class="transport-btn" (click)="viewTransportMap(event.id)">
                ğŸ—ºï¸ Ver Mapa de Asientos
              </button>
              <div class="payment-status-info">
                <div class="payment-status" [class]="getPaymentStatusClass(getPaymentStatusForEvent(event.id).status)">
                  <span class="payment-label">Estado de Pago:</span>
                  <span class="payment-text">{{ getPaymentStatusText(getPaymentStatusForEvent(event.id).status) }}</span>
                </div>
                <div class="payment-amounts" *ngIf="getPaymentStatusForEvent(event.id).total > 0">
                  <span class="payment-amount">Total: ${{ getPaymentStatusForEvent(event.id).total }}</span>
                  <span class="payment-paid" *ngIf="getPaymentStatusForEvent(event.id).paid > 0">Pagado: ${{ getPaymentStatusForEvent(event.id).paid }}</span>
                </div>
              </div>
              <div class="cost-info" *ngIf="getTransportCost(event.id) > 0 && getPaymentStatusForEvent(event.id).status === 'sin-boletos'">
                <span class="cost-text">ğŸ’° ${{ getUnitCost(event.id) }} por persona (estimado)</span>
              </div>
            </div>
            <button class="view-event-btn" (click)="viewEventDetails(event.id)">
              Ver Detalles
            </button>
          </div>
        </div>
      </div>
      
      <div class="no-events" *ngIf="activeEvents.length === 0">
        <p>No hay eventos prÃ³ximos</p>
      </div>
    </div>

    <!-- Indicadores de Asistencia por Tipo -->
    <div class="attendance-indicators">
      <h3>Mi Asistencia por Actividad</h3>
      
      <!-- GrÃ¡fica Global -->
      <div class="global-attendance">
        <div class="global-card" (click)="goToTracking()">
          <div class="global-header">
            <span class="global-icon">ğŸ“Š</span>
            <h4>Asistencia General</h4>
            <p>Todas las actividades</p>
          </div>
          <div class="global-indicator">
            <svg width="160" height="160" viewBox="0 0 160 160">
              <circle 
                cx="80" 
                cy="80" 
                r="65" 
                fill="none" 
                stroke="#e2e8f0" 
                stroke-width="12">
              </circle>
              <circle 
                cx="80" 
                cy="80" 
                r="65" 
                fill="none" 
                stroke="url(#globalGradient)" 
                stroke-width="12"
                [attr.stroke-dasharray]="408.41"
                [attr.stroke-dashoffset]="408.41 - (globalAttendanceStats.percentage * 408.41) / 100"
                transform="rotate(-90 80 80)"
                stroke-linecap="round">
              </circle>
              <defs>
                <linearGradient id="globalGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#189d98;stop-opacity:1" />
                  <stop offset="50%" style="stop-color:#4299e1;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#f56565;stop-opacity:1" />
                </linearGradient>
              </defs>
            </svg>
            <div class="global-center">
              <span class="global-percentage">{{ globalAttendanceStats.percentage }}%</span>
              <span class="global-label">Total</span>
            </div>
          </div>
          <div class="global-breakdown">
            <div class="breakdown-item">
              <span class="breakdown-icon">ğŸ‰</span>
              <span class="breakdown-count">{{ eventAttendanceStats.attended }}/{{ eventAttendanceStats.total }}</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-icon">ğŸµ</span>
              <span class="breakdown-count">{{ rehearsalAttendanceStats.attended }}/{{ rehearsalAttendanceStats.total }}</span>
            </div>
            <div class="breakdown-item">
              <span class="breakdown-icon">â›ª</span>
              <span class="breakdown-count">{{ massAttendanceStats.attended }}/{{ massAttendanceStats.total }}</span>
            </div>
          </div>
          <div class="global-total">
            <span class="total-label">Total Actividades</span>
            <span class="total-count">{{ globalAttendanceStats.attended }} de {{ globalAttendanceStats.total }}</span>
          </div>
        </div>
      </div>
      
      <div class="indicators-container">
        
        <!-- Asistencia a Eventos -->
        <div class="indicator-card" (click)="goToTracking()">
          <div class="indicator-header">
            <span class="indicator-icon">ğŸ‰</span>
            <h4>Eventos</h4>
          </div>
          <div class="circular-indicator">
            <svg width="120" height="120" viewBox="0 0 120 120">
              <circle 
                cx="60" 
                cy="60" 
                r="50" 
                fill="none" 
                stroke="#e2e8f0" 
                stroke-width="10">
              </circle>
              <circle 
                cx="60" 
                cy="60" 
                r="50" 
                fill="none" 
                stroke="#f56565" 
                stroke-width="10"
                [attr.stroke-dasharray]="314.16"
                [attr.stroke-dashoffset]="314.16 - (eventAttendanceStats.percentage * 314.16) / 100"
                transform="rotate(-90 60 60)">
              </circle>
            </svg>
            <div class="indicator-center">
              <span class="percentage">{{ eventAttendanceStats.percentage }}%</span>
            </div>
          </div>
          <div class="indicator-stats">
            <span class="attended">{{ eventAttendanceStats.attended }}</span>
            <span class="separator">/</span>
            <span class="total">{{ eventAttendanceStats.total }}</span>
          </div>
          <p class="indicator-label">Participaciones</p>
        </div>

        <!-- Asistencia a Ensayos -->
        <div class="indicator-card" (click)="goToTracking()">
          <div class="indicator-header">
            <span class="indicator-icon">ğŸµ</span>
            <h4>Ensayos</h4>
          </div>
          <div class="circular-indicator">
            <svg width="120" height="120" viewBox="0 0 120 120">
              <circle 
                cx="60" 
                cy="60" 
                r="50" 
                fill="none" 
                stroke="#e2e8f0" 
                stroke-width="10">
              </circle>
              <circle 
                cx="60" 
                cy="60" 
                r="50" 
                fill="none" 
                stroke="#4299e1" 
                stroke-width="10"
                [attr.stroke-dasharray]="314.16"
                [attr.stroke-dashoffset]="314.16 - (rehearsalAttendanceStats.percentage * 314.16) / 100"
                transform="rotate(-90 60 60)">
              </circle>
            </svg>
            <div class="indicator-center">
              <span class="percentage">{{ rehearsalAttendanceStats.percentage }}%</span>
            </div>
          </div>
          <div class="indicator-stats">
            <span class="attended">{{ rehearsalAttendanceStats.attended }}</span>
            <span class="separator">/</span>
            <span class="total">{{ rehearsalAttendanceStats.total }}</span>
          </div>
          <p class="indicator-label">Asistencias</p>
        </div>

        <!-- Asistencia a Misa -->
        <div class="indicator-card" (click)="goToTracking()">
          <div class="indicator-header">
            <span class="indicator-icon">â›ª</span>
            <h4>Misa Dominical</h4>
          </div>
          <div class="circular-indicator">
            <svg width="120" height="120" viewBox="0 0 120 120">
              <circle 
                cx="60" 
                cy="60" 
                r="50" 
                fill="none" 
                stroke="#e2e8f0" 
                stroke-width="10">
              </circle>
              <circle 
                cx="60" 
                cy="60" 
                r="50" 
                fill="none" 
                stroke="#ffd700" 
                stroke-width="10"
                [attr.stroke-dasharray]="314.16"
                [attr.stroke-dashoffset]="314.16 - (massAttendanceStats.percentage * 314.16) / 100"
                transform="rotate(-90 60 60)">
              </circle>
            </svg>
            <div class="indicator-center">
              <span class="percentage">{{ massAttendanceStats.percentage }}%</span>
            </div>
          </div>
          <div class="indicator-stats">
            <span class="attended">{{ massAttendanceStats.attended }}</span>
            <span class="separator">/</span>
            <span class="total">{{ massAttendanceStats.total }}</span>
          </div>
          <p class="indicator-label">Asistencias</p>
        </div>
        
      </div>
    </div>

    <!-- BotÃ³n para ver Ranking de Asistencia -->
    <div class="ranking-button-section" *ngIf="membersAttendanceList.length > 0">
      <button class="ranking-btn" (click)="openRankingModal()">
        <div class="ranking-btn-content">
          <span class="ranking-btn-icon">ğŸ†</span>
          <div class="ranking-btn-text">
            <h4>Ranking de Asistencia</h4>
            <p>Ver posiciones de todos los integrantes</p>
          </div>
          <span class="ranking-btn-count">{{ membersAttendanceList.length }} integrantes</span>
        </div>
      </button>
    </div>

    <!-- Indicador de Insumos -->
    <div class="inventory-summary">
      <div class="summary-card">
        <div class="summary-header">
          <div class="summary-icon">ğŸ“¦</div>
          <div class="summary-title">
            <h3>Inventario Disponible</h3>
            <p>Insumos con stock disponible ({{ totalInsumosConStock }} artÃ­culos)</p>
          </div>
        </div>
        
        <!-- Lista de todos los insumos con stock -->
        <div class="inventory-list" *ngIf="insumosConStock.length > 0">
          <div class="inventory-item" *ngFor="let insumo of insumosConStock" 
               [class.low-stock]="insumo.cantidadDisponible <= insumo.cantidadMinima">
            <div class="item-info">
              <span class="item-name">{{ insumo.nombre }}</span>
              <span class="item-category">{{ insumo.categoria }}</span>
            </div>
            <div class="item-stock">
              <span class="stock-number">{{ insumo.cantidadDisponible }}</span>
              <span class="stock-label">disponibles</span>
              <span class="warning-icon" *ngIf="insumo.cantidadDisponible <= insumo.cantidadMinima">âš ï¸</span>
            </div>
          </div>
        </div>
        
        <!-- Mensaje cuando no hay insumos -->
        <div class="no-inventory" *ngIf="insumosConStock.length === 0">
          <div class="no-inventory-icon">ğŸ“­</div>
          <div class="no-inventory-text">
            <h4>No hay insumos disponibles</h4>
            <p>Actualmente no hay insumos con stock en el inventario</p>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Modal de Mapa de Asientos -->
  <div class="transport-modal" *ngIf="showTransportModal" (click)="closeTransportModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ—ºï¸ Mapa de Asientos del Transporte</h3>
        <button class="close-btn" (click)="closeTransportModal()">âœ•</button>
      </div>
      
      <div class="modal-body">

        
        <div class="my-transport-info">
          <h4>ğŸ‘¤ Mi InformaciÃ³n de Transporte</h4>
          <div class="my-seats" *ngIf="getMySeats().length > 0">
            <div class="seat-info" *ngFor="let seatInfo of getMySeats()">
              <div class="seat-details">
                <span class="passenger-name">{{ seatInfo.passengerName }}</span>
                <span class="seat-location">VehÃ­culo {{ seatInfo.vehicleIndex + 1 }} - Asiento {{ seatInfo.seatIndex + 1 }}</span>
                <span class="passenger-type">{{ seatInfo.isCompanion ? 'AcompaÃ±ante' : 'Integrante' }}</span>
              </div>
              <div class="cost-info">
                <span class="individual-cost">${{ getUnitCostFromConfig() }}</span>
              </div>
            </div>
            <div class="total-cost">
              <span class="total-label">Total a pagar:</span>
              <span class="total-amount">${{ getMyTotalCost() }}</span>
            </div>
          </div>
          <div class="no-seats" *ngIf="getMySeats().length === 0">
            <p>AÃºn no tienes asientos asignados</p>
          </div>
        </div>
        
        <div class="vehicles-section">
          <h4>DistribuciÃ³n de Asientos</h4>
          <div class="vehicles-grid">
            <div class="vehicle-card" *ngFor="let vehicle of selectedTransportConfig?.vehicles; let i = index">
              <div class="vehicle-header">
                <h5>ğŸš VehÃ­culo {{ i + 1 }}</h5>
                <div class="vehicle-info">
                  <span class="occupancy">{{ vehicle.occupiedSeats }}/{{ vehicle.totalSeats }}</span>
                  <span class="vehicle-cost" *ngIf="vehicle.vehicleCost > 0">${{ vehicle.vehicleCost }}</span>
                </div>
              </div>
              
              <div class="vehicle-pricing" *ngIf="vehicle.vehicleCost > 0 && vehicle.occupiedSeats > 0">
                <span class="price-per-seat">ğŸ’° ${{ (vehicle.vehicleCost / vehicle.occupiedSeats).toFixed(2) }} por asiento</span>
              </div>
              
              <div class="vehicle-schedule-info" *ngIf="vehicle.boardingTime || vehicle.departureTime">
                <div class="schedule-info" *ngIf="vehicle.boardingTime">
                  <span class="schedule-icon">ğŸ•°ï¸</span>
                  <span class="schedule-text">Abordaje: {{ vehicle.boardingTime }}</span>
                </div>
                <div class="schedule-info" *ngIf="vehicle.departureTime">
                  <span class="schedule-icon">ğŸš€</span>
                  <span class="schedule-text">Salida: {{ vehicle.departureTime }}</span>
                </div>
              </div>
              <div class="seats-grid">
                <div 
                  class="seat" 
                  *ngFor="let seat of vehicle.seats; let j = index"
                  [class.occupied]="seat.occupied"
                  [class.my-seat]="isMyseat(seat)">
                  <span *ngIf="seat.occupied" class="seat-label">{{ seat.passengerName }}</span>
                  <span *ngIf="!seat.occupied" class="seat-number">{{ j + 1 }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="close-btn-footer" (click)="closeTransportModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Movimientos de Tarjeta -->
  <div class="movements-modal" *ngIf="showMovementsModal" (click)="closeMovementsModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h4>ğŸ’³ Historial de Movimientos</h4>
        <button class="close-btn" (click)="closeMovementsModal()">âœ•</button>
      </div>
      
      <div class="modal-body">
        <div class="account-summary">
          <div class="account-info">
            <span class="account-name">{{ userAccount?.userName }}</span>
            <span class="account-number">{{ userAccount?.accountNumber }}</span>
          </div>
          <div class="current-balance">
            <span class="balance-amount">${{ userAccount?.balance?.toFixed(2) }}</span>
          </div>
        </div>

        <div class="filter-section">
          <label for="movementFilter">Filtrar por tipo:</label>
          <select id="movementFilter" [(ngModel)]="movementFilter" (change)="onMovementFilterChange()">
            <option value="all">Todos los movimientos</option>
            <option value="deposit">Solo depÃ³sitos</option>
            <option value="withdrawal">Solo retiros</option>
          </select>
        </div>

        <div class="movements-list" *ngIf="filteredMovements.length > 0">
          <div class="movement-item" *ngFor="let movement of filteredMovements" [class]="getMovementClass(movement.type)">
            <div class="movement-content">
              <div class="movement-info">
                <span class="movement-concept">{{ movement.concept }}</span>
                <span class="movement-date">{{ movement.createdAt?.toDate() | date:'dd/MM/yyyy HH:mm' }}</span>
                <span class="movement-user" *ngIf="movement.createdBy">Por: {{ getUserName(movement.createdBy) }}</span>
              </div>
              <span class="movement-amount" [class]="movement.type">
                {{ movement.type === 'deposit' ? '+' : '-' }}${{ movement.amount.toFixed(2) }}
              </span>
            </div>
          </div>
        </div>

        <div class="no-movements" *ngIf="filteredMovements.length === 0 && cardMovements.length > 0">
          <div class="empty-state">
            <div class="empty-icon">ğŸ”</div>
            <h4>No hay movimientos de este tipo</h4>
            <p>Cambia el filtro para ver otros movimientos</p>
          </div>
        </div>

        <div class="no-movements" *ngIf="cardMovements.length === 0">
          <div class="empty-state">
            <div class="empty-icon">ğŸ’³</div>
            <h4>Sin movimientos</h4>
            <p>AÃºn no tienes transacciones en tu cuenta</p>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="close-btn-footer" (click)="closeMovementsModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Ranking de Asistencia -->
  <div class="ranking-modal" *ngIf="showRankingModal" (click)="closeRankingModal()">
    <div class="modal-content ranking-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ† Ranking de Asistencia</h3>
        <p class="modal-subtitle">Integrantes ordenados por asistencia total</p>
        <button class="close-btn" (click)="closeRankingModal()">âœ•</button>
      </div>
      
      <div class="modal-body ranking-modal-body">
        <div class="members-list">
          <div *ngFor="let member of membersAttendanceList; let i = index" class="member-row">
            <div class="member-rank">
              <span class="rank-number">{{ i + 1 }}</span>
              <span class="rank-medal" *ngIf="i < 3">
                {{ i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰' }}
              </span>
            </div>
            
            <div class="member-info">
              <h4 class="member-name">{{ member.name }}</h4>
              <div class="member-stats">
                <span class="total-activities">{{ member.totalStats.attended }}/{{ member.totalStats.total }} actividades</span>
              </div>
            </div>
            
            <div class="member-indicators">
              <!-- Ensayos -->
              <div class="mini-indicator rehearsal">
                <svg width="40" height="40" viewBox="0 0 40 40">
                  <circle cx="20" cy="20" r="16" fill="none" stroke="#e2e8f0" stroke-width="3"></circle>
                  <circle 
                    cx="20" cy="20" r="16" 
                    fill="none" 
                    stroke="#4299e1" 
                    stroke-width="3"
                    [attr.stroke-dasharray]="100.53"
                    [attr.stroke-dashoffset]="100.53 - (member.rehearsalPercentage * 100.53) / 100"
                    transform="rotate(-90 20 20)"
                    stroke-linecap="round">
                  </circle>
                </svg>
                <div class="mini-center">
                  <span class="mini-percentage">{{ member.rehearsalPercentage }}%</span>
                </div>
                <div class="mini-label">
                  <span class="mini-text">Ensayos</span>
                </div>
              </div>
              
              <!-- Eventos -->
              <div class="mini-indicator event">
                <svg width="40" height="40" viewBox="0 0 40 40">
                  <circle cx="20" cy="20" r="16" fill="none" stroke="#e2e8f0" stroke-width="3"></circle>
                  <circle 
                    cx="20" cy="20" r="16" 
                    fill="none" 
                    stroke="#f56565" 
                    stroke-width="3"
                    [attr.stroke-dasharray]="100.53"
                    [attr.stroke-dashoffset]="100.53 - (member.eventPercentage * 100.53) / 100"
                    transform="rotate(-90 20 20)"
                    stroke-linecap="round">
                  </circle>
                </svg>
                <div class="mini-center">
                  <span class="mini-percentage">{{ member.eventPercentage }}%</span>
                </div>
                <div class="mini-label">
                  <span class="mini-text">Eventos</span>
                </div>
              </div>
              
              <!-- Misas -->
              <div class="mini-indicator mass">
                <svg width="40" height="40" viewBox="0 0 40 40">
                  <circle cx="20" cy="20" r="16" fill="none" stroke="#e2e8f0" stroke-width="3"></circle>
                  <circle 
                    cx="20" cy="20" r="16" 
                    fill="none" 
                    stroke="#ffd700" 
                    stroke-width="3"
                    [attr.stroke-dasharray]="100.53"
                    [attr.stroke-dashoffset]="100.53 - (member.massPercentage * 100.53) / 100"
                    transform="rotate(-90 20 20)"
                    stroke-linecap="round">
                  </circle>
                </svg>
                <div class="mini-center">
                  <span class="mini-percentage">{{ member.massPercentage }}%</span>
                </div>
                <div class="mini-label">
                  <span class="mini-text">Misas</span>
                </div>
              </div>
              
              <!-- Total -->
              <div class="mini-indicator total">
                <svg width="45" height="45" viewBox="0 0 45 45">
                  <defs>
                    <linearGradient [attr.id]="'memberGradient' + i" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" style="stop-color:#189d98;stop-opacity:1" />
                      <stop offset="50%" style="stop-color:#4299e1;stop-opacity:1" />
                      <stop offset="100%" style="stop-color:#f56565;stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <circle cx="22.5" cy="22.5" r="18" fill="none" stroke="#e2e8f0" stroke-width="4"></circle>
                  <circle 
                    cx="22.5" cy="22.5" r="18" 
                    fill="none" 
                    [attr.stroke]="'url(#memberGradient' + i + ')'" 
                    stroke-width="4"
                    [attr.stroke-dasharray]="113.1"
                    [attr.stroke-dashoffset]="113.1 - (member.totalPercentage * 113.1) / 100"
                    transform="rotate(-90 22.5 22.5)"
                    stroke-linecap="round">
                  </circle>
                </svg>
                <div class="mini-center total-center">
                  <span class="mini-percentage total-percentage">{{ member.totalPercentage }}%</span>
                </div>
                <div class="mini-label">
                  <span class="mini-text">Total</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="close-btn-footer" (click)="closeRankingModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Editar Perfil -->
  <div class="profile-modal" *ngIf="showProfileModal" (click)="closeProfileModal()">
    <div class="modal-content profile-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ‘¤ Mi Perfil</h3>
        <p class="modal-subtitle">Edita tu informaciÃ³n personal</p>
        <button class="close-btn" (click)="closeProfileModal()">âœ•</button>
      </div>
      
      <div class="modal-body profile-modal-body">
        <form class="profile-form" (ngSubmit)="saveProfile()">
          
          <!-- Imagen de Perfil -->
          <div class="form-group profile-image-section">
            <label class="form-label">Foto de Perfil</label>
            <div class="image-upload-container">
              <div class="current-image" *ngIf="profileForm.profileImage">
                <img [src]="profileForm.profileImage" alt="Imagen de perfil" class="profile-image-preview">
              </div>
              <div class="no-image" *ngIf="!profileForm.profileImage">
                <span class="no-image-icon">ğŸ“·</span>
                <span class="no-image-text">Sin imagen</span>
              </div>
              <input 
                type="file" 
                id="profileImage" 
                accept="image/*" 
                (change)="onFileSelected($event)"
                class="file-input">
              <label for="profileImage" class="file-input-label">
                {{ profileForm.profileImage ? 'Cambiar Imagen' : 'Subir Imagen' }}
              </label>
            </div>
          </div>

          <!-- Nombre -->
          <div class="form-group">
            <label for="name" class="form-label">Nombre Completo *</label>
            <input 
              type="text" 
              id="name" 
              [(ngModel)]="profileForm.name" 
              name="name"
              class="form-input"
              placeholder="Tu nombre completo"
              required>
          </div>

          <!-- Mote/Apodo -->
          <div class="form-group">
            <label for="nickname" class="form-label">Mote/Apodo</label>
            <input 
              type="text" 
              id="nickname" 
              [(ngModel)]="profileForm.nickname" 
              name="nickname"
              class="form-input"
              placeholder="Como te gusta que te digan">
          </div>

          <!-- CumpleaÃ±os -->
          <div class="form-group birthday-section">
            <label class="form-label">Fecha de CumpleaÃ±os</label>
            <div class="birthday-inputs">
              <div class="day-input">
                <label for="birthDay" class="sub-label">DÃ­a</label>
                <select 
                  id="birthDay" 
                  [(ngModel)]="profileForm.birthDay" 
                  name="birthDay"
                  class="form-select">
                  <option value="">--</option>
                  <option *ngFor="let day of [].constructor(31); let i = index" 
                          [value]="(i + 1).toString().padStart(2, '0')">
                    {{ i + 1 }}
                  </option>
                </select>
              </div>
              
              <div class="month-input">
                <label for="birthMonth" class="sub-label">Mes</label>
                <select 
                  id="birthMonth" 
                  [(ngModel)]="profileForm.birthMonth" 
                  name="birthMonth"
                  class="form-select">
                  <option value="">Seleccionar mes</option>
                  <option *ngFor="let month of months" [value]="month.value">
                    {{ month.name }}
                  </option>
                </select>
              </div>
            </div>
          </div>

        </form>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="cancel-btn" (click)="closeProfileModal()">Cancelar</button>
        <button type="button" class="save-btn" (click)="saveProfile()">Guardar Cambios</button>
      </div>
    </div>
  </div>
</div>