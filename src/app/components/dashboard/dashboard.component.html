<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <img src="assets/estonantzin.jpeg" alt="Logo Estudiantina" class="logo">
        <h4>Estudiantina Tonantzin Guadalupe</h4>
      </div>
      <div class="user-info">
        <span>Bienvenid@, {{ userProfile?.name || user?.email }}</span>
        <button class="logout-btn" (click)="logout()">Cerrar Sesión</button>
      </div>
    </div>
  </header>

  <main class="dashboard-main">
    <div class="admin-menu" *ngIf="isAdmin">
      <h3>Panel de Administración</h3>
      <button class="admin-btn" routerLink="/admin">
        <span class="admin-icon">⚙️</span>
        Gestionar Usuarios
      </button>
    </div>

    <div class="attendance-menu" *ngIf="canManageAttendance">
      <h3>Control de Asistencia</h3>
      <div class="attendance-buttons">
        <button class="attendance-btn" routerLink="/attendance">
          <span class="attendance-icon">📅</span>
          Pasar Asistencia
        </button>
        <button class="summary-btn" routerLink="/attendance-summary">
          <span class="summary-icon">📊</span>
          Resumen General
        </button>
      </div>
    </div>

    <div class="attendance-chart" (click)="goToTracking()">
      <h3>Mi Asistencia</h3>
      <div class="charts-container">
        <div class="donut-chart">
          <svg width="150" height="150" viewBox="0 0 150 150">
            <circle cx="75" cy="75" r="60" fill="none" stroke="#e1e5e9" stroke-width="15" *ngIf="attendancePercentage < 100"></circle>
            <circle 
              cx="75" 
              cy="75" 
              r="60" 
              fill="none" 
              stroke="#189d98" 
              stroke-width="15"
              [attr.stroke-dasharray]="attendancePercentage === 100 ? '377' : (attendancePercentage * 377) / 100 + ' 377'"
              [attr.stroke-dashoffset]="attendancePercentage === 100 ? '0' : '94.25'"
              [attr.transform]="attendancePercentage === 100 ? '' : 'rotate(-90 75 75)'">
            </circle>
          </svg>
          <div class="chart-center">
            <span class="percentage">{{ attendancePercentage }}%</span>
            <span class="label">Efectiva</span>
          </div>
        </div>
        
        <div class="donut-chart">
          <svg width="150" height="150" viewBox="0 0 150 150">
            <circle cx="75" cy="75" r="60" fill="none" stroke="#e1e5e9" stroke-width="15" *ngIf="participationPercentage < 100"></circle>
            <circle 
              cx="75" 
              cy="75" 
              r="60" 
              fill="none" 
              stroke="#189d98" 
              stroke-width="15"
              [attr.stroke-dasharray]="participationPercentage === 100 ? '377' : (participationPercentage * 377) / 100 + ' 377'"
              [attr.stroke-dashoffset]="participationPercentage === 100 ? '0' : '94.25'"
              [attr.transform]="participationPercentage === 100 ? '' : 'rotate(-90 75 75)'">
            </circle>
          </svg>
          <div class="chart-center">
            <span class="percentage">{{ participationPercentage }}%</span>
            <span class="label">Asistencia</span>
          </div>
        </div>
      </div>
      
      <div class="attendance-summary">
        <h4>Resumen de Asistencia</h4>
        <div class="summary-list">

          <div class="summary-item">
            <span class="summary-icon">✅</span>
            <span class="summary-label">Presente</span>
            <div class="summary-count">
              <span class="count-fraction">{{ attendanceStats.presente }} de {{ totalAttendances }}</span>
              <span class="count-percentage">({{ getPercentage(attendanceStats.presente) }}%)</span>
            </div>
          </div>
          <div class="summary-item">
            <span class="summary-icon">🏫</span>
            <span class="summary-label">Escuela</span>
            <div class="summary-count">
              <span class="count-fraction">{{ attendanceStats.escuela }} de {{ totalAttendances }}</span>
              <span class="count-percentage">({{ getPercentage(attendanceStats.escuela) }}%)</span>
            </div>
          </div>
          <div class="summary-item">
            <span class="summary-icon">🩺</span>
            <span class="summary-label">Enfermedad</span>
            <div class="summary-count">
              <span class="count-fraction">{{ attendanceStats.enfermedad }} de {{ totalAttendances }}</span>
              <span class="count-percentage">({{ getPercentage(attendanceStats.enfermedad) }}%)</span>
            </div>
          </div>
          <div class="summary-item">
            <span class="summary-icon">❌</span>
            <span class="summary-label">Falta</span>
            <div class="summary-count">
              <span class="count-fraction">{{ attendanceStats.falta }} de {{ totalAttendances }}</span>
              <span class="count-percentage">({{ getPercentage(attendanceStats.falta) }}%)</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="misa-chart" (click)="goToTracking()">
      <h3>Misa Dominical</h3>
      <div class="misa-donut">
        <svg width="200" height="200" viewBox="0 0 200 200">
          <circle 
            cx="100" 
            cy="100" 
            r="80" 
            fill="none" 
            stroke="#ffd700" 
            stroke-width="20">
          </circle>
        </svg>
        <div class="chart-center">
          <span class="percentage">{{ misaStats.percentage }}%</span>
          <span class="label">Asistencia</span>
        </div>
      </div>
      <div class="misa-stats">
        <div class="misa-stat">
          <span class="stat-number">{{ misaStats.asistidas }}</span>
          <span class="stat-label">Asistidas</span>
        </div>
        <div class="misa-stat">
          <span class="stat-number">{{ misaStats.faltas }}</span>
          <span class="stat-label">Faltas</span>
        </div>
        <div class="misa-stat">
          <span class="stat-number">{{ misaStats.total }}</span>
          <span class="stat-label">Total</span>
        </div>
      </div>
    </div>
  </main>
</div>