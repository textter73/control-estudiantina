<div class="event-details-container" *ngIf="event">
  <header class="event-details-header">
    <div class="header-content">
      <button class="back-btn" (click)="goBack()">
        ← Volver
      </button>
      <h1>{{ event.title }}</h1>
    </div>
  </header>

  <main class="event-details-main">
    <!-- Información del evento -->
    <div class="event-info-card">
      <div class="event-info-header">
        <h2>Información del Evento</h2>
        <div class="event-badges">
          <span class="type-badge" [class]="event.type">{{ getTypeText(event.type) }}</span>
          <span class="attire-badge" [class]="event.attire">{{ getAttireText(event.attire) }}</span>
          <span class="status-badge" [class]="'status-' + event.status">{{ getStatusText(event.status) }}</span>
        </div>
      </div>

      <div class="event-details-grid">
        <div class="detail-item">
          <span class="detail-icon">📅</span>
          <div class="detail-content">
            <span class="detail-label">Fecha</span>
            <span class="detail-value">{{ event.date }}</span>
          </div>
        </div>

        <div class="detail-item" *ngIf="event.location">
          <span class="detail-icon">📍</span>
          <div class="detail-content">
            <span class="detail-label">Ubicación del Evento</span>
            <span class="detail-value">{{ event.location }}</span>
          </div>
        </div>

        <div class="detail-item" *ngIf="event.meetingPoint">
          <span class="detail-icon">🚩</span>
          <div class="detail-content">
            <span class="detail-label">Punto de Reunión</span>
            <span class="detail-value">{{ event.meetingPoint }}</span>
          </div>
        </div>

        <div class="detail-item full-width" *ngIf="event.meetingTime || event.startTime || event.endTime">
          <span class="detail-icon">🕰️</span>
          <div class="detail-content">
            <span class="detail-label">Horarios</span>
            <div class="schedule-times">
              <div class="schedule-item" *ngIf="event.meetingTime">
                <span class="schedule-label">Reunión:</span>
                <span class="schedule-time">{{ event.meetingTime }}</span>
              </div>
              <div class="schedule-item" *ngIf="event.startTime">
                <span class="schedule-label">Inicio:</span>
                <span class="schedule-time">{{ event.startTime }}</span>
              </div>
              <div class="schedule-item" *ngIf="event.endTime">
                <span class="schedule-label">Fin:</span>
                <span class="schedule-time">{{ event.endTime }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="detail-item" *ngIf="event.requiresTransport">
          <span class="detail-icon">🚌</span>
          <div class="detail-content">
            <span class="detail-label">Transporte</span>
            <span class="detail-value transport-highlight">Se requiere transporte</span>
          </div>
        </div>

        <div class="detail-item" *ngIf="event.hasTravelCost">
          <span class="detail-icon">💰</span>
          <div class="detail-content">
            <span class="detail-label">Costo de Traslado</span>
            <span class="detail-value cost-highlight">{{ event.travelCost || 'Por confirmar' }}</span>
          </div>
        </div>

        <div class="detail-item full-width" *ngIf="event.description">
          <span class="detail-icon">📝</span>
          <div class="detail-content">
            <span class="detail-label">Descripción</span>
            <span class="detail-value">{{ event.description }}</span>
          </div>
        </div>
      </div>
    </div>



    <!-- Confirmación -->
    <div class="confirmation-card" *ngIf="event.status === 'abierto'">
      <h3>Confirmación de Asistencia</h3>
      <p>Por favor, confirma tu asistencia al evento:</p>

      <div class="my-response" *ngIf="userConfirmation">
        <h4>Tu confirmación:</h4>
        <span class="response-badge" [class]="getResponseClass(userConfirmation.response)">
          {{ getResponseText(userConfirmation.response) }}
        </span>
        <div class="companions-info" *ngIf="event.requiresTransport && userConfirmation.companions !== undefined">
          <p><strong>Acompañantes:</strong> {{ userConfirmation.companions || 0 }}</p>
        </div>
        <p class="final-note">Tu confirmación ha sido registrada y no puede ser modificada.</p>
      </div>

      <div class="response-section" *ngIf="!userConfirmation">
        <p class="instruction-text">Selecciona tu confirmación de asistencia:</p>
        
        <div class="response-buttons">
          <button 
            class="response-btn yes-btn" 
            (click)="selectResponse('asistire')">
            ✅ Asistiré
          </button>
          <button 
            class="response-btn maybe-btn" 
            (click)="selectResponse('tal-vez')">
            🤔 Tal vez
          </button>
          <button 
            class="response-btn no-btn" 
            (click)="selectResponse('no-asistire')">
            ❌ No asistiré
          </button>
        </div>

        <div class="companions-section" *ngIf="selectedResponse && event.requiresTransport">
          <h4>🚌 ¿Cuántas personas te acompañarán?</h4>
          <div class="companions-input">
            <label for="companions">Número de acompañantes:</label>
            <select [(ngModel)]="companions" name="companions" class="companions-select">
              <option value="0">Solo yo</option>
              <option value="1">1 acompañante</option>
              <option value="2">2 acompañantes</option>
            </select>
          </div>
        </div>

        <button 
          class="confirm-btn" 
          *ngIf="selectedResponse"
          (click)="submitConfirmation()"
          [disabled]="event.requiresTransport && companions === null">
          Confirmar Asistencia
        </button>
      </div>

      <div class="stats-summary">
        <h4>Resumen de Confirmaciones</h4>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number">{{ getConfirmationStats().asistire }}</span>
            <span class="stat-label">Asistiré</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getConfirmationStats().talVez }}</span>
            <span class="stat-label">Tal vez</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getConfirmationStats().noAsistire }}</span>
            <span class="stat-label">No asistiré</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getConfirmationStats().total }}</span>
            <span class="stat-label">Total</span>
          </div>
          <div class="stat-item" *ngIf="event.requiresTransport">
            <span class="stat-number">{{ getConfirmationStats().totalCompanions }}</span>
            <span class="stat-label">Acompañantes</span>
          </div>
          <div class="stat-item" *ngIf="event.requiresTransport">
            <span class="stat-number">{{ getConfirmationStats().totalPeople }}</span>
            <span class="stat-label">Total personas</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado finalizado o cancelado -->
    <div class="status-message" *ngIf="event.status === 'finalizado' || event.status === 'cancelado'">
      <div class="status-icon">
        {{ event.status === 'finalizado' ? '✅' : '❌' }}
      </div>
      <h3>{{ event.status === 'finalizado' ? 'Evento Finalizado' : 'Evento Cancelado' }}</h3>
      <p>{{ event.status === 'finalizado' ? 'Este evento ya ha concluido.' : 'Este evento ha sido cancelado.' }}</p>
    </div>

    <!-- Lista de respuestas (solo para administradores/agenda) -->
    <div class="responses-list">
      <h3>Respuestas de Integrantes</h3>
      <button *ngIf="userProfile?.profiles?.includes('administrador') || userProfile?.profiles?.includes('agenda')"
        class="admin-btn" style="margin-bottom:1rem; background:#e8f2ff; color:#0b63c6; border-color:#bcd7ff;"
        (click)="copyConfirmationsToClipboard()">
        📋 Copiar respuestas para WhatsApp
      </button>
      <div class="tab-content" *ngIf="event.status === 'abierto'">
        <h4>Confirmaciones</h4>
        <div class="response-item" *ngFor="let c of event.confirmations">
          <div *ngIf="editingConfirmationId !== c.userId">
            <div class="response-main">
              <span class="user-name">{{ c.userName }}</span>
              <span class="response-badge" [class]="getResponseClass(c.response)">
                {{ getResponseText(c.response) }}
              </span>
              <div class="admin-controls" *ngIf="userProfile?.profiles?.includes('administrador') || userProfile?.profiles?.includes('agenda')">
                <button class="admin-btn edit-btn" (click)="startEditConfirmation(c)">✏️ Editar</button>
                <button class="admin-btn delete-btn" (click)="deleteConfirmation(c)">🗑 Eliminar</button>
              </div>
            </div>
            <div class="companions-count" *ngIf="event.requiresTransport && c.companions !== undefined">
              <span class="companions-text">🚌 {{ c.companions }} acompañantes</span>
            </div>
          </div>

          <!-- Inline edit form for admins -->
          <div *ngIf="editingConfirmationId === c.userId" class="edit-form" style="background:#f8f9fa; border-radius:10px; padding:1rem; margin-top:0.5rem;">
            <h5 style="margin-bottom:1rem; color:#189d98; font-size:1rem;">Editar confirmación - {{ c.userName }}</h5>
            <div class="edit-row" style="display:flex; align-items:center; gap:1rem; margin-bottom:1rem;">
              <label style="min-width:90px; color:#555;">Respuesta:</label>
              <select [(ngModel)]="editSelectedResponse" class="edit-select" style="padding:0.4rem 0.8rem; border-radius:8px; border:1px solid #e0e0e0;">
                <option value="asistire">Asistiré</option>
                <option value="tal-vez">Tal vez</option>
                <option value="no-asistire">No asistiré</option>
              </select>
            </div>
            <div class="edit-row" *ngIf="event.requiresTransport" style="display:flex; align-items:center; gap:1rem; margin-bottom:1rem;">
              <label style="min-width:90px; color:#555;">Acompañantes:</label>
              <input type="number" min="0" [(ngModel)]="editCompanions" class="edit-input" style="padding:0.4rem 0.8rem; border-radius:8px; border:1px solid #e0e0e0; max-width:100px;" />
            </div>
            <div class="admin-controls" style="display:flex; gap:0.5rem; justify-content:flex-end;">
              <button class="admin-btn save-btn" (click)="saveEditConfirmation(c)">💾 Guardar</button>
              <button class="admin-btn cancel-btn" (click)="cancelEdit()">Cancelar</button>
            </div>
          </div>
        </div>
        
        <div class="transport-summary" *ngIf="event.requiresTransport">
          <h5>Resumen de Transporte</h5>
          <p><strong>Total de personas:</strong> {{ getTotalPeople() }}</p>
        </div>
      </div>
    </div>
  </main>
</div>