<div class="event-details-container" *ngIf="event">
  <header class="event-details-header">
    <div class="header-content">
      <button class="back-btn" (click)="goBack()">
        â† Volver
      </button>
      <h1>{{ event.title }}</h1>
    </div>
  </header>

  <main class="event-details-main">
    <!-- InformaciÃ³n del evento -->
    <div class="event-info-card">
      <div class="event-info-header">
        <h2>InformaciÃ³n del Evento</h2>
        <div class="event-badges">
          <span class="type-badge" [class]="event.type">{{ getTypeText(event.type) }}</span>
          <span class="attire-badge" [class]="event.attire">{{ getAttireText(event.attire) }}</span>
          <span class="status-badge" [class]="'status-' + event.status">{{ getStatusText(event.status) }}</span>
        </div>
      </div>

      <div class="event-details-grid">
        <div class="detail-item">
          <span class="detail-icon">ğŸ“…</span>
          <div class="detail-content">
            <span class="detail-label">Fecha</span>
            <span class="detail-value">{{ event.date }}</span>
          </div>
        </div>

        <div class="detail-item" *ngIf="event.location">
          <span class="detail-icon">ğŸ“</span>
          <div class="detail-content">
            <span class="detail-label">UbicaciÃ³n del Evento</span>
            <span class="detail-value">{{ event.location }}</span>
          </div>
        </div>

        <div class="detail-item" *ngIf="event.meetingPoint">
          <span class="detail-icon">ğŸš©</span>
          <div class="detail-content">
            <span class="detail-label">Punto de ReuniÃ³n</span>
            <span class="detail-value">{{ event.meetingPoint }}</span>
          </div>
        </div>

        <div class="detail-item full-width" *ngIf="event.meetingTime || event.startTime || event.endTime">
          <span class="detail-icon">ğŸ•°ï¸</span>
          <div class="detail-content">
            <span class="detail-label">Horarios</span>
            <div class="schedule-times">
              <div class="schedule-item" *ngIf="event.meetingTime">
                <span class="schedule-label">ReuniÃ³n:</span>
                <span class="schedule-time">{{ event.meetingTime }}</span>
              </div>
              <div class="schedule-item" *ngIf="event.startTime">
                <span class="schedule-label">Inicio:</span>
                <span class="schedule-time">{{ event.startTime }}</span>
              </div>
              <div class="schedule-item" *ngIf="event.endTime">
                <span class="schedule-label">Fin:</span>
                <span class="schedule-time">{{ event.endTime }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="detail-item" *ngIf="event.requiresTransport">
          <span class="detail-icon">ğŸšŒ</span>
          <div class="detail-content">
            <span class="detail-label">Transporte</span>
            <span class="detail-value transport-highlight">Se requiere transporte</span>
          </div>
        </div>

        <div class="detail-item" *ngIf="event.hasTravelCost">
          <span class="detail-icon">ğŸ’°</span>
          <div class="detail-content">
            <span class="detail-label">Costo de Traslado</span>
            <span class="detail-value cost-highlight">{{ event.travelCost || 'Por confirmar' }}</span>
          </div>
        </div>

        <div class="detail-item full-width" *ngIf="event.description">
          <span class="detail-icon">ğŸ“</span>
          <div class="detail-content">
            <span class="detail-label">DescripciÃ³n</span>
            <span class="detail-value">{{ event.description }}</span>
          </div>
        </div>
      </div>
    </div>



    <!-- ConfirmaciÃ³n -->
    <div class="confirmation-card" *ngIf="event.status === 'abierto'">
      <h3>ConfirmaciÃ³n de Asistencia</h3>
      <p>Por favor, confirma tu asistencia al evento:</p>

      <div class="my-response" *ngIf="userConfirmation">
        <h4>Tu confirmaciÃ³n:</h4>
        <span class="response-badge" [class]="getResponseClass(userConfirmation.response)">
          {{ getResponseText(userConfirmation.response) }}
        </span>
        <div class="companions-info" *ngIf="event.requiresTransport && userConfirmation.companions !== undefined">
          <p><strong>AcompaÃ±antes:</strong> {{ userConfirmation.companions || 0 }}</p>
        </div>
        <p class="final-note">Tu confirmaciÃ³n ha sido registrada y no puede ser modificada.</p>
      </div>

      <div class="response-section" *ngIf="!userConfirmation">
        <p class="instruction-text">Selecciona tu confirmaciÃ³n de asistencia:</p>
        
        <div class="response-buttons">
          <button 
            class="response-btn yes-btn" 
            (click)="selectResponse('asistire')">
            âœ… AsistirÃ©
          </button>
          <button 
            class="response-btn maybe-btn" 
            (click)="selectResponse('tal-vez')">
            ğŸ¤” Tal vez
          </button>
          <button 
            class="response-btn no-btn" 
            (click)="selectResponse('no-asistire')">
            âŒ No asistirÃ©
          </button>
        </div>

        <div class="companions-section" *ngIf="selectedResponse && event.requiresTransport">
          <h4>ğŸšŒ Â¿CuÃ¡ntas personas te acompaÃ±arÃ¡n?</h4>
          <div class="companions-input">
            <label for="companions">NÃºmero de acompaÃ±antes:</label>
            <select [(ngModel)]="companions" name="companions" class="companions-select">
              <option value="0">Solo yo</option>
              <option value="1">1 acompaÃ±ante</option>
              <option value="2">2 acompaÃ±antes</option>
            </select>
          </div>
        </div>

        <button 
          class="confirm-btn" 
          *ngIf="selectedResponse"
          (click)="submitConfirmation()"
          [disabled]="event.requiresTransport && companions === null">
          Confirmar Asistencia
        </button>
      </div>

      <div class="stats-summary">
        <h4>Resumen de Confirmaciones</h4>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number">{{ getConfirmationStats().asistire }}</span>
            <span class="stat-label">AsistirÃ©</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getConfirmationStats().talVez }}</span>
            <span class="stat-label">Tal vez</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getConfirmationStats().noAsistire }}</span>
            <span class="stat-label">No asistirÃ©</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getConfirmationStats().total }}</span>
            <span class="stat-label">Total</span>
          </div>
          <div class="stat-item" *ngIf="event.requiresTransport">
            <span class="stat-number">{{ getConfirmationStats().totalCompanions }}</span>
            <span class="stat-label">AcompaÃ±antes</span>
          </div>
          <div class="stat-item" *ngIf="event.requiresTransport">
            <span class="stat-number">{{ getConfirmationStats().totalPeople }}</span>
            <span class="stat-label">Total personas</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado finalizado o cancelado -->
    <div class="status-message" *ngIf="event.status === 'finalizado' || event.status === 'cancelado'">
      <div class="status-icon">
        {{ event.status === 'finalizado' ? 'âœ…' : 'âŒ' }}
      </div>
      <h3>{{ event.status === 'finalizado' ? 'Evento Finalizado' : 'Evento Cancelado' }}</h3>
      <p>{{ event.status === 'finalizado' ? 'Este evento ya ha concluido.' : 'Este evento ha sido cancelado.' }}</p>
    </div>

    <!-- Lista de respuestas (solo para administradores/agenda) -->
    <div class="responses-list">
      <h3>Respuestas de Integrantes</h3>
      
      <!-- Botones de administraciÃ³n -->
      <div class="admin-actions" *ngIf="userProfile?.profiles?.includes('administrador') || userProfile?.profiles?.includes('agenda')">
        <button class="admin-btn copy-btn" 
          (click)="copyConfirmationsToClipboard()">
          ğŸ“‹ Copiar respuestas para WhatsApp
        </button>
        
        <button class="admin-btn confirm-all-btn" 
          (click)="confirmAllPendingUsers()"
          *ngIf="event.status === 'abierto'">
          âœ… Confirmar usuarios pendientes
        </button>
        
        <button class="admin-btn add-user-btn" 
          (click)="addUserConfirmation()"
          *ngIf="event.status === 'abierto'">
          â• Agregar confirmaciÃ³n individual
        </button>
      </div>
      <div class="tab-content" *ngIf="event.status === 'abierto'">
        <h4>Confirmaciones</h4>
        <div class="response-item" *ngFor="let c of event.confirmations">
          <div *ngIf="editingConfirmationId !== c.userId">
            <div class="response-main">
              <span class="user-name">{{ c.userName }}</span>
              <span class="response-badge" [class]="getResponseClass(c.response)">
                {{ getResponseText(c.response) }}
              </span>
              <div class="admin-controls" *ngIf="userProfile?.profiles?.includes('administrador') || userProfile?.profiles?.includes('agenda')">
                <button class="admin-btn edit-btn" (click)="startEditConfirmation(c)">âœï¸ Editar</button>
                <button class="admin-btn delete-btn" (click)="deleteConfirmation(c)">ğŸ—‘ Eliminar</button>
              </div>
            </div>
            <div class="companions-count" *ngIf="event.requiresTransport && c.companions !== undefined">
              <span class="companions-text">ğŸšŒ {{ c.companions }} acompaÃ±antes</span>
            </div>
          </div>

          <!-- Inline edit form for admins -->
          <div *ngIf="editingConfirmationId === c.userId" class="edit-form" style="background:#f8f9fa; border-radius:10px; padding:1rem; margin-top:0.5rem;">
            <h5 style="margin-bottom:1rem; color:#189d98; font-size:1rem;">Editar confirmaciÃ³n - {{ c.userName }}</h5>
            <div class="edit-row" style="display:flex; align-items:center; gap:1rem; margin-bottom:1rem;">
              <label style="min-width:90px; color:#555;">Respuesta:</label>
              <select [(ngModel)]="editSelectedResponse" class="edit-select" style="padding:0.4rem 0.8rem; border-radius:8px; border:1px solid #e0e0e0;">
                <option value="asistire">AsistirÃ©</option>
                <option value="tal-vez">Tal vez</option>
                <option value="no-asistire">No asistirÃ©</option>
              </select>
            </div>
            <div class="edit-row" *ngIf="event.requiresTransport" style="display:flex; align-items:center; gap:1rem; margin-bottom:1rem;">
              <label style="min-width:90px; color:#555;">AcompaÃ±antes:</label>
              <input type="number" min="0" [(ngModel)]="editCompanions" class="edit-input" style="padding:0.4rem 0.8rem; border-radius:8px; border:1px solid #e0e0e0; max-width:100px;" />
            </div>
            <div class="admin-controls" style="display:flex; gap:0.5rem; justify-content:flex-end;">
              <button class="admin-btn save-btn" (click)="saveEditConfirmation(c)">ğŸ’¾ Guardar</button>
              <button class="admin-btn cancel-btn" (click)="cancelEdit()">Cancelar</button>
            </div>
          </div>
        </div>
        
        <!-- Usuarios pendientes de confirmar -->
        <div class="pending-users" *ngIf="(userProfile?.profiles?.includes('administrador') || userProfile?.profiles?.includes('agenda')) && getPendingUsers().length > 0">
          <h5>Usuarios sin confirmar ({{ getPendingUsers().length }})</h5>
          <div class="pending-users-list">
            <span class="pending-user" *ngFor="let user of getPendingUsers()">
              {{ user.name || user.email }}
            </span>
          </div>
        </div>
        
        <div class="transport-summary" *ngIf="event.requiresTransport">
          <h5>Resumen de Transporte</h5>
          <p><strong>Total de personas:</strong> {{ getTotalPeople() }}</p>
        </div>
      </div>
    </div>
  </main>
</div>