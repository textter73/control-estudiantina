<div>
  <!-- T√≠tulo removido para ocupar todo el ancho -->
  <div *ngIf="loading">Cargando canciones...</div>
  <div *ngIf="!loading && songs.length === 0">No hay canciones registradas.</div>
  <div *ngIf="!loading && songs.length > 0">
    <div class="transport-container">
      <header class="transport-header">
        <div class="header-content">
          <div class="logo-section">
            <h2>üéµ Cancionero</h2>
          </div>
          <div class="user-info">
            <button class="back-btn" routerLink="/dashboard">
              ‚Üê Dashboard
            </button>
          </div>
        </div>
      </header>

      <main class="transport-main">
        <div class="search-container">
          <div class="search-box">
            <input 
              type="text" 
              class="search-input" 
              placeholder="Buscar canciones..." 
              [(ngModel)]="searchTerm"
              (input)="filterSongs()">
            <span class="search-icon">üîç</span>
          </div>
          <div class="category-filter">
            <select 
              class="category-select" 
              [(ngModel)]="selectedCategory"
              (change)="filterSongs()">
              <option value="">Todas las categor√≠as</option>
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>
          </div>
        </div>

        <div class="songs-container">
          <div class="loading-state" *ngIf="loading">
            <div class="loading-spinner"></div>
            <p>Cargando canciones...</p>
          </div>
          
          <div class="empty-state" *ngIf="!loading && songs.length === 0">
            <div class="empty-icon">üéµ</div>
            <h3>No hay canciones registradas</h3>
            <p>Agrega tu primera canci√≥n al cancionero</p>
          </div>
          
          <div class="songs-grid" *ngIf="!loading && filteredSongs.length > 0">
            <div class="song-card" *ngFor="let song of filteredSongs; let i = index">
              <div class="song-header">
                <div class="song-info-inline">
                  <div class="song-number">{{ i + 1 }}</div>
                  <h3 class="song-title" (click)="openSongDetail(song)">{{ song.title }}</h3>
                </div>
                <div class="song-badges">
                  <span class="badge category-badge">{{ song.category }}</span>
                  <span class="badge status-badge">{{ song.status }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Modal para mostrar detalle de la canci√≥n -->
          <div class="song-modal" 
               [class.screenshot-protection]="!isEditing" 
               *ngIf="selectedSong" 
               (click)="closeSongDetail()">
            <div class="modal-content" 
                 [class.protected-content]="!isEditing" 
                 (click)="$event.stopPropagation()">
              
              <!-- Botones flotantes de zoom -->
              <div class="zoom-controls">
                <button class="zoom-btn zoom-out" (click)="zoomOut()" [disabled]="fontSize <= minFontSize" title="Reducir tama√±o">
                  A-
                </button>
                <button class="zoom-btn zoom-reset" (click)="resetZoom()" title="Tama√±o normal">
                  A
                </button>
                <button class="zoom-btn zoom-in" (click)="zoomIn()" [disabled]="fontSize >= maxFontSize" title="Aumentar tama√±o">
                  A+
                </button>
              </div>
              
              <div class="modal-header">
                <h2 *ngIf="!isEditing">{{ selectedSong.title }}</h2>
                <input 
                  *ngIf="isAdmin && isEditing"
                  [(ngModel)]="editedTitle"
                  class="edit-input title-input"
                  placeholder="T√≠tulo de la canci√≥n"
                  type="text">
                <div class="header-actions">
                  <button *ngIf="canEditSongs" class="edit-btn" (click)="startEditing()">
                    ‚úèÔ∏è Editar
                  </button>
                  <button class="close-btn" (click)="closeSongDetail()">√ó</button>
                </div>
              </div>
              <div class="modal-body">
                <div class="song-info-compact" *ngIf="!isEditing">
                  <span class="info-badge">{{ selectedSong.category }}</span>
                  <span class="info-badge">{{ selectedSong.status }}</span>
                  <span class="info-badge" *ngIf="selectedSong.composers">{{ selectedSong.composers }}</span>
                </div>
                
                <!-- Formulario de edici√≥n de informaci√≥n b√°sica -->
                <div class="song-info-edit" *ngIf="isAdmin && isEditing">
                  <div class="edit-row">
                    <label>Categor√≠a:</label>
                    <input 
                      [(ngModel)]="editedCategory"
                      class="edit-input"
                      placeholder="Categor√≠a"
                      type="text">
                  </div>
                  <div class="edit-row">
                    <label>Estado:</label>
                    <select [(ngModel)]="editedStatus" class="edit-select">
                      <option value="">Seleccionar estado</option>
                      <option value="Aprendiendo">Aprendiendo</option>
                      <option value="En proceso">En proceso</option>
                      <option value="Completada">Completada</option>
                      <option value="Repertorio">Repertorio</option>
                    </select>
                  </div>
                  <div class="edit-row">
                    <label>Compositores:</label>
                    <input 
                      [(ngModel)]="editedComposers"
                      class="edit-input"
                      placeholder="Compositores"
                      type="text">
                  </div>
                  <div class="edit-row">
                    <label>Enlace de YouTube:</label>
                    <input 
                      [(ngModel)]="editedYoutubeLink"
                      class="edit-input"
                      placeholder="https://www.youtube.com/watch?v=..."
                      type="url">
                  </div>
                </div>
                
                <!-- Secci√≥n de Instrumentaci√≥n -->
                <div class="instrumentation-section" 
                     [class.protected-content]="!isEditing" 
                     *ngIf="selectedSong.instrumentation || (isAdmin && isEditing)">
                  <h3>Instrumentaci√≥n</h3>
                  <pre class="instrumentation-content" 
                       [class.no-select]="!isEditing" 
                       [style.font-size.px]="fontSize"
                       *ngIf="!isEditing">{{ selectedSong.instrumentation }}</pre>
                  <textarea 
                    *ngIf="isAdmin && isEditing"
                    [(ngModel)]="editedInstrumentation"
                    class="edit-textarea"
                    placeholder="Describe la instrumentaci√≥n...&#10;Ejemplo:&#10;Guitarra: Capo 3er traste&#10;Bajo: Afinaci√≥n est√°ndar&#10;Percusi√≥n: Caj√≥n peruano"
                    rows="5">
                  </textarea>
                </div>
                
                <!-- Secci√≥n de Letra -->
                <div class="lyrics-section" 
                     [class.protected-content]="!isEditing">
                  <h3>Letra</h3>
                  
                  <pre class="lyrics-content" 
                       [class.no-select]="!isEditing" 
                       [class.protected-text]="!isEditing" 
                       [style.font-size.px]="fontSize"
                       *ngIf="!isEditing">{{ selectedSong.structure || 'No hay letra disponible para esta canci√≥n.' }}</pre>
                  
                  <textarea 
                    *ngIf="isAdmin && isEditing"
                    [(ngModel)]="editedStructure"
                    class="edit-textarea lyrics-textarea"
                    placeholder="Escribe la letra de la canci√≥n con acordes...&#10;Ejemplo:&#10;    C        F       G&#10;Hab√≠a una vez una historia..."
                    rows="15">
                  </textarea>
                </div>
                
                <!-- Botones de edici√≥n -->
                <div class="edit-actions" *ngIf="isAdmin && isEditing">
                  <button class="save-btn" (click)="saveChanges()" [disabled]="isSaving">
                    <span *ngIf="!isSaving">üíæ Guardar</span>
                    <span *ngIf="isSaving">‚è≥ Guardando...</span>
                  </button>
                  <button class="cancel-btn" (click)="cancelEditing()">
                    ‚ùå Cancelar
                  </button>
                </div>
                
                <!-- Secci√≥n de Video -->
                <div class="video-section" *ngIf="selectedSong.youtubeLink">
                  <h3>Video</h3>
                  <div class="video-container" 
                       [class.active]="isWatchingVideo"
                       [class.floating]="isVideoFloating"
                       (mouseenter)="onVideoInteractionStart($event)" 
                       (mouseleave)="onVideoInteractionEnd()"
                       (click)="onVideoInteractionStart($event)"
                       (touchstart)="onVideoInteractionStart($event)">
                    <iframe 
                      [src]="getYouTubeEmbedUrl(selectedSong.youtubeLink)" 
                      frameborder="0" 
                      allowfullscreen
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      class="youtube-iframe"
                      (mouseenter)="onVideoInteractionStart($event)"
                      (click)="onVideoInteractionStart($event)">
                    </iframe>
                    <!-- Bot√≥n para minimizar/maximizar video -->
                    <button class="video-toggle-btn" 
                            *ngIf="isWatchingVideo"
                            (click)="toggleVideoFloat($event)"
                            [title]="isVideoFloating ? 'Maximizar video' : 'Minimizar video'">
                      {{ isVideoFloating ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è' }}
                    </button>
                  </div>
                  <p class="video-hint">üí° Tip: Haz clic en el video para interactuar libremente con √©l</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
</div>
